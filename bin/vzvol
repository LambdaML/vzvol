#!/bin/sh

ZUSER=$( whoami )
SIZE=10G
VOLNAME=DIE
FSTYPE=DIE
errorfunc=MAIN
IMPORTIMG=DIE
VZVOL_PROGRESS_FLAG=NO
NO_CREATE=NO

case "$( uname -s )" in
	FreeBSD)
		if pkg info | grep -q sudo; then
			VZVOL_SU_CMD="sudo"
		else
			VZVOL_SU_CMD="su - root -c"
		fi
	;;
	Linux)
		VZVOL_SU_CMD="sudo"
	;;
esac

if [ "$(zpool list | awk '{ zPools[NR-1]=$1 } END { print zPools[1] }')" = bootpool ]; then
	ZROOT=$(zpool list | awk '{ zPools[NR-1]=$1 } END { print zPools[2] }')
else
	ZROOT=$(zpool list | awk '{ zPools[NR-1]=$1 } END { print zPools[1] }')
fi

getargz "$@" || error_code
zvol_check || error_code
if [ "$NO_CREATE" = "YES" ]; then 
	if [ ! "${IMPORTIMG}" = DIE ]; then
		zvol_import_img || return 1
	fi
else
	zvol_type_select || error_code
fi
exit 0
